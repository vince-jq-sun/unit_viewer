## Introduction

Units Viewer is a tool tailored for researchers working with datasets composed of multiple units, such as neurons. Ideally, it works best for hundreds to thousands of units. It makes figure navigation, tagging, filtering, and notes easy and engaging. By directly viewing various plots and filtering the ones that are most relevant, it helps build better intuition.

## Features

- Very easy to use.
- View detailed profiles of individual neurons.
- Customizable tags and notes for every unit.
- Flexible filtering and tracking of tags to streamline the inspection process.
- Easy navigation through large datasets.
- Local web-based interface for easy access.

Quick Panel and Function Overview
![Panel Introduction](panel_introduction.jpg)

## Installation

Ensure Node.js is installed on your system before starting, as this project is built using Node.js. You can find instructions in our [Node.js Installation Guide](install_node.md) (generated by chatGPT).

## Preparation

1. Clone the repository or download the `units_viewer` folder to your local machine.
2. Open your terminal and navigate to the project directory.
3. Run `npm install` to install all required dependencies.
4. Prepare a 'units' folder (name doesn't matter) anywhere in your computer. Organize your figures within this folder by subfolders named with unit IDs. Put all the images you want to review into the folders named with the unit IDs.
5. It's recommended to also place your custom `tags.json` file (name does not matter) in 'units' folder. So, you can have basic tags to start with, for example, units' anatomical locations or types. This is optional.


## Starting the Viewer

1. Ensure that the images are correctly placed in their respective folders.
2. In terminal (or IDE) navigate to the `units_viewer` directory and execute `npm start`. This will open the Units Viewer in your default web browser.
3. If it does not automatically open, you can manually access it by visiting [localhost:2024](http://localhost:2024).
4. Click the purple link on the top right corner to set (or change) the path to your 'units' folder.
5. If you have multiple tag files in your 'units' folder, you can select which one to use by clicking the dropdown list below the purple link.
6. If you don't have a tag file or you want to use a new one, you can create a one by clicking __NewJS__., type in the name and confirm. Then, add the names of all image folders as keys to this new file by clicking __FillAll__. and confirm.

## Navigation and Tagging

- Navigate though units by clicking __←__ for the previous, __→__ for the next, corresponding to _Ctrl_ + _1_ and _Ctrl_ + _2_ respectively.
- The current unit ID is shown in bold. `(i/n)` after the unit ID stands for _(i-th unit / total number of units within current selection)_.
- Tags can be added or removed by entering the tag in the text box and clicking __+__ or __-__.
- Notes can be added by prefixing the text with `%` and clicking __+__. As notes are automatically indexed, to remove the n-th note, you can type `%n` in the text box and click __-__.
- All changes to tags and notes will be saved automatically.

## Filtering and tracking

- Use the text box and __Filter__ button to search for unit IDs and tags. 
- By default, input in the text box is treated as tags. Enter quoted strings to match portions of unit IDs, or prefix the text with `%` to specify notes.
- Supports logical operations like `&&` (`#and#`), `++` (`#or#`), `^^` (`#not#`). Logical operations are applied sequentially from left to right. Adding space between an operation and its operands is optional.
- Filtering can be matched to tags (default), part of notes (%xxx), and part of unit IDs ("xxx").
- The latest implemented filter text will be shown right above the text box.
- All tags of the current selection of neurons will be shown right below the filtering block. The part of the texts matching the current filter (tags, notes or unit IDs) will be highlighted in blue.
- Use the __Track__ button to make a few tags more noticeable; separate the tags with commas in the text box. Tracked tags possessed by current unit will be highlighted in pink.
- To clear the filters or tracking settings, click __Filter__ or __Track__ with an empty text box.

### Filter Examples
space between operators and operands is optional.

1. Simple tag search:
   `tag1`

2. Multiple tags (AND operation):
   `tag1 && tag2`

3. Multiple tags (OR operation):
   `tag1 ++ tag2`

4. Excluding a tag:
   `tag1 ^^ tag2`

5. Combining operations:
   `tag1 && tag2 ^^ tag3`

6. Searching for a note:
   `%note1`

7. Combining tag and note search:
   `tag1 && %note1`

8. Searching for part of an ID:
   `"id_part"`

9. Complex search combining tags, notes, and ID:
   `tag1 && %note1 ++ "id_part"`

10. Using word-based logical operators:
    `tag1 #and# tag2 #or# tag3 #not# tag4`

11. Searching for multiple notes:
    `%note1 ++ %note2`

12. Combining ID search with tag exclusion:
    `"id_part" ^^ tag1`

13. Complex search with multiple operations:
    `tag1 && (tag2 ++ tag3) ^^ %note1 && "id_part"`

Remember:
- Use `&&` or `#and#` for AND operations
- Use `++` or `#or#` for OR operations
- Use `^^` or `#not#` for NOT operations
- Prefix notes with `%`
- Enclose ID parts in quotes `""`
- Spaces between operators and operands are optional


## Display

- All the images in the folder named with the current unit ID will be shown in the display window onf the left. The images will be resized and stacked in a gird structure, powered by [Masonry](https://masonry.desandro.com/).
- Use the slider at the bottom of the control panel to set the number of columns for the grid.
- The ratio of the image panel and the control panel is resizable.
- Supported image formats: .jpg, .jpeg, .png, .bmp, .tiff, .gif, .webp., .svg, .pdf, .eps

## Potential future features
- add a toggle to switch between row-wise and column-wise display.
- You name it.

## Contributing

Contributions are welcome! If you have suggestions for improvements or bug fixes, please open an issue or submit a pull request.

## License

This project is licensed under the Apache License, Version 2.0. See the [LICENSE](LICENSE) file for more details.


## Support

Questions are welcomed at vince.sun[at]nyu.edu or on the GitHub issues page.

Thank you for using Units Viewer!

If you find this tool helpful and would like to support my work, consider buying me a coffee! Your support is greatly appreciated and helps me continue developing and improving this tool.

<img src="bmc_qr.png" width="150" height="150">

To quickly support the project, simply scan the QR code with your phone’s camera to visit my Buy Me a Coffee page.